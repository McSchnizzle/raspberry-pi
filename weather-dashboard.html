<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=800, height=480, initial-scale=1.0">
<title>Weather</title>
<style>
  @font-face {
    font-family: 'System';
    src: local('.SFNSDisplay-Ultralight'), local('HelveticaNeue-UltraLight'), local('Segoe UI Light'), local('sans-serif-light');
  }

  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --fg: rgba(255,255,255,0.95);
    --fg-dim: rgba(255,255,255,0.55);
    --fg-muted: rgba(255,255,255,0.35);
    --glass: rgba(255,255,255,0.08);
    --glass-border: rgba(255,255,255,0.12);
  }

  html, body {
    width: 800px;
    height: 480px;
    overflow: hidden;
    font-family: -apple-system, 'Segoe UI', 'Helvetica Neue', sans-serif;
    color: var(--fg);
    cursor: none;
    user-select: none;
    -webkit-font-smoothing: antialiased;
  }

  body {
    background: linear-gradient(160deg, #0f1b2d 0%, #1a1a3e 50%, #0d0d1f 100%);
    transition: background 4s ease;
    position: relative;
  }

  /* Atmospheric orb â€” gives depth */
  body::before {
    content: '';
    position: absolute;
    top: -80px;
    right: -60px;
    width: 360px;
    height: 360px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--orb-color, rgba(100,140,255,0.15)) 0%, transparent 70%);
    filter: blur(40px);
    transition: background 4s ease;
    pointer-events: none;
    z-index: 0;
  }

  /* Subtle grain texture */
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    opacity: 0.025;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 100;
  }

  .container {
    position: relative;
    z-index: 1;
    width: 800px;
    height: 480px;
    display: grid;
    grid-template-rows: auto 1fr auto;
    padding: 28px 36px 20px;
  }

  /* === TOP BAR === */
  .top-bar {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
  }

  .location {
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--fg-dim);
  }

  .clock-area {
    text-align: right;
  }

  .time {
    font-size: 13px;
    font-weight: 300;
    letter-spacing: 0.08em;
    color: var(--fg-dim);
    font-variant-numeric: tabular-nums;
  }

  .date {
    font-size: 11px;
    color: var(--fg-muted);
    letter-spacing: 0.06em;
    margin-top: 1px;
  }

  /* === MAIN WEATHER === */
  .main-weather {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-top: -12px;
  }

  .temp-block {
    display: flex;
    align-items: flex-start;
    line-height: 1;
  }

  .weather-icon {
    font-size: 80px;
    line-height: 1;
    filter: drop-shadow(0 4px 20px rgba(0,0,0,0.3));
    margin-right: 8px;
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }

  .temp-value {
    font-size: 128px;
    font-weight: 200;
    letter-spacing: -0.04em;
    line-height: 0.85;
    background: linear-gradient(180deg, var(--fg) 40%, var(--fg-dim) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .temp-unit {
    font-size: 32px;
    font-weight: 200;
    color: var(--fg-muted);
    margin-top: 16px;
    margin-left: 2px;
  }

  .condition-text {
    font-size: 16px;
    font-weight: 400;
    color: var(--fg-dim);
    text-align: center;
    margin-top: -8px;
    letter-spacing: 0.04em;
  }

  /* === STATS ROW === */
  .stats-row {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-top: 6px;
  }

  .stat {
    text-align: center;
  }

  .stat-label {
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: var(--fg-muted);
    margin-bottom: 4px;
  }

  .stat-value {
    font-size: 18px;
    font-weight: 300;
    color: var(--fg-dim);
    font-variant-numeric: tabular-nums;
  }

  .stat-unit {
    font-size: 11px;
    color: var(--fg-muted);
  }

  /* === FORECAST === */
  .forecast-strip {
    display: flex;
    justify-content: space-between;
    gap: 8px;
    margin-top: 14px;
    padding-top: 16px;
    border-top: 1px solid var(--glass-border);
  }

  .forecast-day {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 10px 0 6px;
    border-radius: 12px;
    background: var(--glass);
    border: 1px solid transparent;
    transition: border-color 0.3s, background 0.3s;
  }

  .forecast-day.today {
    border-color: var(--glass-border);
    background: rgba(255,255,255,0.1);
  }

  .forecast-name {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--fg-muted);
  }

  .forecast-day.today .forecast-name {
    color: var(--fg-dim);
  }

  .forecast-icon {
    font-size: 24px;
    line-height: 1;
  }

  .forecast-temps {
    display: flex;
    align-items: baseline;
    gap: 6px;
  }

  .forecast-high {
    font-size: 15px;
    font-weight: 400;
    color: var(--fg);
  }

  .forecast-low {
    font-size: 12px;
    font-weight: 300;
    color: var(--fg-muted);
  }

  /* === LOADING === */
  .loading {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 50;
    background: inherit;
  }

  .loading-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--fg-dim);
    margin: 0 4px;
    animation: pulse 1.4s ease-in-out infinite;
  }

  .loading-dot:nth-child(2) { animation-delay: 0.2s; }
  .loading-dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes pulse {
    0%, 80%, 100% { opacity: 0.2; transform: scale(0.8); }
    40% { opacity: 1; transform: scale(1.2); }
  }

  .hidden { display: none !important; }

  /* Fade in */
  .container { animation: fadeIn 1.2s ease; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

<div class="loading" id="loading">
  <div class="loading-dot"></div>
  <div class="loading-dot"></div>
  <div class="loading-dot"></div>
</div>

<div class="container hidden" id="app">
  <div class="top-bar">
    <div class="location" id="location">Locating&hellip;</div>
    <div class="clock-area">
      <div class="time" id="time"></div>
      <div class="date" id="date"></div>
    </div>
  </div>

  <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;">
    <div class="main-weather">
      <div class="weather-icon" id="weatherIcon">&#x2600;</div>
      <div class="temp-block">
        <span class="temp-value" id="temp">&mdash;</span>
        <span class="temp-unit">&deg;F</span>
      </div>
    </div>
    <div class="condition-text" id="condition">Loading&hellip;</div>
    <div class="stats-row">
      <div class="stat">
        <div class="stat-label">Humidity</div>
        <div class="stat-value"><span id="humidity">&mdash;</span><span class="stat-unit">%</span></div>
      </div>
      <div class="stat">
        <div class="stat-label">Wind</div>
        <div class="stat-value"><span id="wind">&mdash;</span> <span class="stat-unit">mph</span></div>
      </div>
      <div class="stat">
        <div class="stat-label">Feels Like</div>
        <div class="stat-value"><span id="feelslike">&mdash;</span><span class="stat-unit">&deg;</span></div>
      </div>
      <div class="stat">
        <div class="stat-label">UV Index</div>
        <div class="stat-value" id="uv">&mdash;</div>
      </div>
    </div>
  </div>

  <div class="forecast-strip" id="forecast"></div>
</div>

<script>
const WMO_MAP = {
  0:  { text: 'Clear Sky',        icon: 'â˜€ï¸',  night: 'ðŸŒ™' },
  1:  { text: 'Mostly Clear',     icon: 'ðŸŒ¤ï¸', night: 'ðŸŒ™' },
  2:  { text: 'Partly Cloudy',    icon: 'â›…',   night: 'â˜ï¸' },
  3:  { text: 'Overcast',         icon: 'â˜ï¸',   night: 'â˜ï¸' },
  45: { text: 'Foggy',            icon: 'ðŸŒ«ï¸', night: 'ðŸŒ«ï¸' },
  48: { text: 'Rime Fog',         icon: 'ðŸŒ«ï¸', night: 'ðŸŒ«ï¸' },
  51: { text: 'Light Drizzle',    icon: 'ðŸŒ¦ï¸', night: 'ðŸŒ§ï¸' },
  53: { text: 'Drizzle',          icon: 'ðŸŒ¦ï¸', night: 'ðŸŒ§ï¸' },
  55: { text: 'Heavy Drizzle',    icon: 'ðŸŒ§ï¸', night: 'ðŸŒ§ï¸' },
  61: { text: 'Light Rain',       icon: 'ðŸŒ¦ï¸', night: 'ðŸŒ§ï¸' },
  63: { text: 'Rain',             icon: 'ðŸŒ§ï¸', night: 'ðŸŒ§ï¸' },
  65: { text: 'Heavy Rain',       icon: 'ðŸŒ§ï¸', night: 'ðŸŒ§ï¸' },
  66: { text: 'Freezing Rain',    icon: 'ðŸ§Š',   night: 'ðŸ§Š' },
  67: { text: 'Heavy Freezing Rain', icon: 'ðŸ§Š', night: 'ðŸ§Š' },
  71: { text: 'Light Snow',       icon: 'ðŸŒ¨ï¸', night: 'ðŸŒ¨ï¸' },
  73: { text: 'Snow',             icon: 'â„ï¸',   night: 'â„ï¸' },
  75: { text: 'Heavy Snow',       icon: 'â„ï¸',   night: 'â„ï¸' },
  77: { text: 'Snow Grains',      icon: 'ðŸŒ¨ï¸', night: 'ðŸŒ¨ï¸' },
  80: { text: 'Light Showers',    icon: 'ðŸŒ¦ï¸', night: 'ðŸŒ§ï¸' },
  81: { text: 'Showers',          icon: 'ðŸŒ§ï¸', night: 'ðŸŒ§ï¸' },
  82: { text: 'Heavy Showers',    icon: 'â›ˆï¸',  night: 'â›ˆï¸' },
  85: { text: 'Snow Showers',     icon: 'ðŸŒ¨ï¸', night: 'ðŸŒ¨ï¸' },
  86: { text: 'Heavy Snow Showers', icon: 'â„ï¸', night: 'â„ï¸' },
  95: { text: 'Thunderstorm',     icon: 'â›ˆï¸',  night: 'â›ˆï¸' },
  96: { text: 'Thunderstorm + Hail', icon: 'â›ˆï¸', night: 'â›ˆï¸' },
  99: { text: 'Severe Thunderstorm', icon: 'â›ˆï¸', night: 'â›ˆï¸' },
};

function getWeatherInfo(code, isNight) {
  const entry = WMO_MAP[code] || { text: 'Unknown', icon: 'ðŸŒ¡ï¸', night: 'ðŸŒ¡ï¸' };
  return { text: entry.text, icon: isNight ? entry.night : entry.icon };
}

const DAYS = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

function updateClock() {
  const now = new Date();
  const h = now.getHours();
  const m = String(now.getMinutes()).padStart(2,'0');
  const ampm = h >= 12 ? 'PM' : 'AM';
  const h12 = h % 12 || 12;
  document.getElementById('time').textContent = `${h12}:${m} ${ampm}`;
  document.getElementById('date').textContent = `${DAYS[now.getDay()]}, ${MONTHS[now.getMonth()]} ${now.getDate()}`;
  updateSkyTheme(h + now.getMinutes()/60);
}

function updateSkyTheme(hour) {
  const body = document.body;
  let bg, orb;

  if (hour < 5.5) {
    // Deep night
    bg = 'linear-gradient(160deg, #080e1a 0%, #0f1228 40%, #0a0a16 100%)';
    orb = 'rgba(60,70,130,0.12)';
  } else if (hour < 7) {
    // Dawn
    const t = (hour - 5.5) / 1.5;
    bg = `linear-gradient(160deg,
      hsl(${230-t*30}, ${20+t*30}%, ${5+t*12}%) 0%,
      hsl(${20+t*10}, ${40+t*30}%, ${12+t*18}%) 50%,
      hsl(${280-t*40}, ${25+t*20}%, ${8+t*10}%) 100%)`;
    orb = `rgba(${200+t*55}, ${100+t*80}, ${80+t*40}, ${0.12+t*0.15})`;
  } else if (hour < 10) {
    // Morning
    const t = (hour - 7) / 3;
    bg = `linear-gradient(160deg,
      hsl(${200+t*10}, ${50+t*15}%, ${17+t*15}%) 0%,
      hsl(${210+t*5}, ${45+t*20}%, ${25+t*20}%) 50%,
      hsl(${215}, ${40+t*15}%, ${15+t*15}%) 100%)`;
    orb = `rgba(${140+t*60}, ${180+t*40}, ${255}, ${0.15+t*0.08})`;
  } else if (hour < 17) {
    // Day
    bg = 'linear-gradient(160deg, #1a3a5c 0%, #1e4976 40%, #15304d 100%)';
    orb = 'rgba(180,220,255,0.2)';
  } else if (hour < 19.5) {
    // Evening
    const t = (hour - 17) / 2.5;
    bg = `linear-gradient(160deg,
      hsl(${220-t*20}, ${50-t*10}%, ${30-t*8}%) 0%,
      hsl(${30-t*10}, ${50+t*20}%, ${22-t*4}%) 40%,
      hsl(${270+t*10}, ${35+t*15}%, ${15+t*3}%) 100%)`;
    orb = `rgba(${255-t*40}, ${160-t*60}, ${80+t*20}, ${0.2-t*0.04})`;
  } else if (hour < 21.5) {
    // Dusk
    const t = (hour - 19.5) / 2;
    bg = `linear-gradient(160deg,
      hsl(${240+t*10}, ${30+t*10}%, ${16-t*6}%) 0%,
      hsl(${260+t*10}, ${30+t*15}%, ${14-t*4}%) 50%,
      hsl(${250+t*10}, ${25+t*10}%, ${10-t*3}%) 100%)`;
    orb = `rgba(${100-t*30}, ${80-t*20}, ${180-t*40}, ${0.14-t*0.03})`;
  } else {
    // Night
    bg = 'linear-gradient(160deg, #080e1a 0%, #0f1228 40%, #0a0a16 100%)';
    orb = 'rgba(60,70,130,0.12)';
  }

  body.style.background = bg;
  body.style.setProperty('--orb-color', orb);
}

async function getLocation() {
  try {
    const res = await fetch('http://ip-api.com/json/?fields=lat,lon,city,regionName');
    return await res.json();
  } catch(e) {
    return { lat: 40.7, lon: -74.0, city: 'New York', regionName: 'NY' };
  }
}

async function getWeather(lat, lon) {
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
    `&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,is_day` +
    `&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max` +
    `&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=auto&forecast_days=6`;
  const res = await fetch(url);
  return await res.json();
}

function render(weather, loc) {
  const c = weather.current;
  const d = weather.daily;
  const isNight = !c.is_day;
  const info = getWeatherInfo(c.weather_code, isNight);

  document.getElementById('location').textContent = `${loc.city}, ${loc.regionName}`;
  document.getElementById('temp').textContent = Math.round(c.temperature_2m);
  document.getElementById('weatherIcon').textContent = info.icon;
  document.getElementById('condition').textContent = info.text;
  document.getElementById('humidity').textContent = c.relative_humidity_2m;
  document.getElementById('wind').textContent = Math.round(c.wind_speed_10m);
  document.getElementById('feelslike').textContent = Math.round(c.apparent_temperature);
  document.getElementById('uv').textContent = d.uv_index_max[0].toFixed(1);

  const forecastEl = document.getElementById('forecast');
  forecastEl.innerHTML = '';

  for (let i = 0; i < 6; i++) {
    const date = new Date(d.time[i] + 'T12:00:00');
    const dayName = i === 0 ? 'Today' : DAYS[date.getDay()];
    const fInfo = getWeatherInfo(d.weather_code[i], false);
    const hi = Math.round(d.temperature_2m_max[i]);
    const lo = Math.round(d.temperature_2m_min[i]);

    const div = document.createElement('div');
    div.className = 'forecast-day' + (i === 0 ? ' today' : '');
    div.innerHTML = `
      <span class="forecast-name">${dayName}</span>
      <span class="forecast-icon">${fInfo.icon}</span>
      <div class="forecast-temps">
        <span class="forecast-high">${hi}Â°</span>
        <span class="forecast-low">${lo}Â°</span>
      </div>
    `;
    forecastEl.appendChild(div);
  }

  document.getElementById('loading').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
}

async function init() {
  try {
    const loc = await getLocation();
    const weather = await getWeather(loc.lat, loc.lon);
    render(weather, loc);
  } catch(e) {
    console.error('Weather fetch failed:', e);
    document.getElementById('loading').innerHTML = '<div style="color:rgba(255,255,255,0.5);font-size:14px;">Unable to load weather data. Retrying&hellip;</div>';
    setTimeout(init, 30000);
  }
}

updateClock();
setInterval(updateClock, 1000);
init();
setInterval(init, 15 * 60 * 1000);
</script>
</body>
</html>
